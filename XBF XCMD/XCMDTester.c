/*	°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°	PROJECT:	XCMDTester		FILE:		XCMDTester.c		PURPOSE:	Test XCMDs			COPYRIGHT:	(C) Copyright 1999 by M. Uli Kusterer, all rights reserved.					REACH ME AT:				E-MAIL:		witness@weblayout.com				URL:		http://www.weblayout.com/witness			REVISIONS:		1999-02-12	UK		Created.					°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°° */#pragma mark [Headers]/* ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ	Headers:   ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ */#include	"XCMDClass.h"#include	"XCMDTester.h"typedef short	bool;// Shared lib prototypes:#pragma import onextern long	OpenBlockFile( char* fPath );extern bool	CloseBlockFile( long fileRef );extern bool	CompactBlockFile( long fileRef );extern long	GetRootBlockRef( long fileRef, long blockID );extern void	WriteRootBlock( long fileRef, long blockID, void* inData, long inLength );extern long	GetSubBlockRef( long fileRef, long blockRef, long blockID );extern long	WriteSubBlock( long fileRef, long blockRef, long blockID, void* inData, long inLength );extern void	GetBlockData( long fileRef, long blockRef, void** outData, long* outLength );extern void	DeleteBlock( long fileRef, long blockRef );#pragma import off#pragma mark [Globals]/* ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ	Globals:   ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ */WindowPtr		gWindow = NULL;#pragma mark [Implementation]/* ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ	Implementation:		This is the part of the XTernal that actually does something.		REVISIONS:		2000-06-28	UK		Created.   ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ */void	Implementation(){	Str255		vMode;		if( paramPtr->paramCount == -1 )	// XWindow event!	{		paramPtr->passFlag = false;				DoXWindowEvent( (XWEventInfoPtr)(paramPtr->params[0]) );	}	else	{		GetParamString(1,vMode);		if( EqualString( vMode, "\pon", false, true ) )		{			Rect		box = { 0, 0, 1, 1 };						if( gWindow == NULL )				gWindow = NewXWindow( paramPtr, &box, "\pINVISIBLE -- XBF XCMD", false, 2, false, true );		}		else if( EqualString( vMode, "\poff", false, true ) )		{			Rect		box = { 0, 0, 1, 1 };						CloseXWindow( paramPtr, gWindow );			gWindow = NULL;		}		else if( EqualString( vMode, "\popen", false, true ) )		{			Str255		vPath;			long		vFileRef;						GetParamString(2,vPath);			vFileRef = OpenBlockFile(p2cstr(vPath));						ReturnLong( vFileRef, REPLACE );		}		else if( EqualString( vMode, "\pclose", false, true ) )		{			long		vFileRef;						vFileRef = GetParamNum(2);			CloseBlockFile(vFileRef);		}		else if( EqualString( vMode, "\pcompact", false, true ) )		{			long		vFileRef;						vFileRef = GetParamNum(2);			CompactBlockFile(vFileRef);		}		else if( EqualString( vMode, "\pgetRoot", false, true ) )		{			long		vFileRef,						vBlockID,						vResult;						vFileRef = GetParamNum(2);			vBlockID = GetParamNum(3);			vResult = GetRootBlockRef(vFileRef,vBlockID);						ReturnLong( vResult, REPLACE );		}		else if( EqualString( vMode, "\pgetSub", false, true ) )		{			long		vFileRef,						vBlockID,						vContBlock,						vResult;						vFileRef = GetParamNum(2);			vContBlock = GetParamNum(3);			vBlockID = GetParamNum(4);			vResult = GetSubBlockRef(vFileRef,vContBlock,vBlockID);						ReturnLong( vResult, REPLACE );		}		else if( EqualString( vMode, "\pgetData", false, true ) )		{			long		vFileRef,						vContBlock,						vLength;			char*		vData,						*vReturnData;						vFileRef = GetParamNum(2);			vContBlock = GetParamNum(3);			GetBlockData(vFileRef,vContBlock,&vData,&vLength);						ReturnText( vData, vLength, REPLACE );		}		else if( EqualString( vMode, "\pwriteRoot", false, true ) )		{			long		vFileRef,						vBlockID;			char*		vData,						*vReturnData;						vFileRef = GetParamNum(2);			vBlockID = GetParamNum(3);						HLock( (Handle) paramPtr->params[3] );			WriteRootBlock( vFileRef, vBlockID, (*paramPtr->params[3]), GetHandleSize((Handle) paramPtr->params[3]) -1 );			HUnlock( (Handle) paramPtr->params[3] );		}		else if( EqualString( vMode, "\pwriteSub", false, true ) )		{			long		vFileRef,						vBlockID,						vContBlock;						vFileRef = GetParamNum(2);			vContBlock = GetParamNum(3);			vBlockID = GetParamNum(4);						HLock( (Handle) paramPtr->params[4] );			WriteSubBlock( vFileRef, vContBlock, vBlockID, (*paramPtr->params[4]), GetHandleSize((Handle) paramPtr->params[4]) -1 );			HUnlock( (Handle) paramPtr->params[4] );		}		else if( EqualString( vMode, "\pdelete", false, true ) )		{			long		vFileRef,						vContBlock;						vFileRef = GetParamNum(2);			vContBlock = GetParamNum(3);						DeleteBlock( vFileRef, vContBlock );		}	}}/* ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ	DoXWindowEvent:		Handle an XWindow event.   ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ */void	DoXWindowEvent( XWEventInfoPtr evt ){	gWindow = evt->eventWindow;		switch( evt->event.what )	{		case xOpenEvt:			XWHasInterruptCode( paramPtr, gWindow, true );			XWAlwaysMoveHigh( paramPtr, gWindow, true );			ShowWindow( gWindow );			SelectWindow( gWindow );			break;				case xCloseEvt:			paramPtr->passFlag = true;			break;				case updateEvt:			BeginUpdate( gWindow );			EndUpdate( gWindow );			break;	}}/* ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ	Syntax:		This returns the syntax (= calling conventions) of this XTernal.				This is called when this XTernal is called with a "?" as its only		parameter.		REVISIONS:		1999-02-12	UK		Created.   ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ */void	Syntax(){	ReturnString( "XBF \"open\"|\"close\"|\"compact\"|\"writeRoot\"|\"writeSub\"|\"getRoot\"|\"getSub\"|\"getData\"|\"delete\",<filePath|fileRef>[,<blockRef|blockID>[,<blockData>]]", REPLACE );}/* ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ	Copyright:		This returns the copyright notice for this XTernal.				This is called when this XTernal is called with a "!" as its only		parameter.		REVISIONS:		1999-02-12	UK		Created.   ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ */void	Copyright(){	ReturnString( "XBF XCMD 1.0, © 2000 by M. Uli Kusterer, all rights rsvd. Subject to the FreeCard GPL.", REPLACE );}